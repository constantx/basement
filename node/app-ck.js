// hello dolly
/**
 * Module dependencies.
 */var express=require("express"),app=module.exports=express.createServer(),fs=require("fs");if(process&&process.env&&process.env.NODE_ENV=="development")var port=3e3;else var env=JSON.parse(fs.readFileSync("/home/dotcloud/environment.json","utf-8")),port=env.PORT;app.configure(function(){app.set("views",__dirname+"/views");app.set("view engine","jade");app.set("view options",{layout:!1});app.use(express.bodyParser());app.use(express.methodOverride());app.use(express.cookieParser());app.use(express.session({secret:"nodejsisohsoawesome"}));app.use(express.compiler({src:__dirname+"/public",enable:["less"]}));app.use(express.static(__dirname+"/public"));app.use(express.favicon());app.use(express.logger('":method :url" :status'));app.use(app.router)});app.configure("development",function(){app.use(express.errorHandler({dumpExceptions:!0,showStack:!0}))});app.configure("production",function(){app.use(express.errorHandler())});app.get("/",function(a,b,c){b.render("index",{title:"hello dolly."})});if(!module.parent){app.listen(port);console.log("Express server listening on port %d",app.address().port)}var IO=require("socket.io").listen(app);IO.configure("development",function(){IO.set("log level",2)});IO.configure("production",function(){IO.enable("browser client minification");IO.enable("browser client etag");IO.enable("browser client gzip");IO.set("log level",1);IO.set("transports",["websocket","flashsocket","htmlfile","xhr-polling","jsonp-polling"])});IO.sockets.on("connection",function(a){a.on("hello",function(){a.emit("hello",{data:"hello dolly."})})});